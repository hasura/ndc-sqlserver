---
source: crates/query-engine/tests/tests.rs
expression: result
---
SELECT
  [rows].[json] AS [rows]
FROM
  (
    SELECT
      [Artist].[Name] AS [Name],
      [Albums].[Albums] AS [Albums]
    FROM
      [public].[Artist] AS [Artist]
      LEFT OUTER JOIN LATERAL (
        SELECT
          row_to_json([Albums]) AS [Albums]
        FROM
          (
            SELECT
              *
            FROM
              (
                SELECT
                  coalesce([rows], JSON_VALUE('[]', '$')) AS [rows]
                FROM
                  (
                    SELECT
                      [Album].[Title] AS [Title]
                    FROM
                      [public].[Album] AS [Album]
                    WHERE
                      (
                        (1 = 1)
                        AND ([Artist].[ArtistId] = [Album].[ArtistId])
                      ) FOR JSON PATH,
                      INCLUDE_NULL_VALUES
                  ) AS [rows] FOR JSON PATH,
                  INCLUDE_NULL_VALUES
              ) AS [rows]
              CROSS JOIN (
                SELECT
                  COUNT(*) AS [how_many_albums]
                FROM
                  [public].[Album] AS [Album]
                WHERE
                  (
                    (1 = 1)
                    AND ([Artist].[ArtistId] = [Album].[ArtistId])
                  ) FOR JSON PATH,
                  INCLUDE_NULL_VALUES,
                  WITHOUT_ARRAY_WRAPPER
              ) AS [aggregates] FOR JSON PATH,
              INCLUDE_NULL_VALUES
          ) AS [Albums] FOR JSON PATH,
          INCLUDE_NULL_VALUES
      ) AS [Albums] ON ('true')
    ORDER BY
      [Artist].[ArtistId] ASC OFFSET 1 ROWS FETCH NEXT 5 ROWS ONLY FOR JSON PATH,
      INCLUDE_NULL_VALUES
  ) AS [rows]([json]) FOR JSON PATH,
  INCLUDE_NULL_VALUES,
  WITHOUT_ARRAY_WRAPPER

[]
