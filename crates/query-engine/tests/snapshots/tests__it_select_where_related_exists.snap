---
source: crates/query-engine/tests/tests.rs
expression: result
---
SELECT
  isnull([rows].[row_json], '[]') AS [rows]
FROM
  (
    SELECT
      [artist].[Name] AS [title],
      JSON_QUERY([albums].[json], '$') AS [albums]
    FROM
      [public].[Artist] AS [artist]
      OUTER APPLY (
        SELECT
          isnull([rows].[row_json], '[]') AS [rows]
        FROM
          (
            SELECT
              [album].[Title] AS [title]
            FROM
              [public].[Album] AS [album]
            WHERE
              (
                (1 = 1)
                AND ([artist].[ArtistId] = [album].[ArtistId])
              ) FOR JSON PATH,
              INCLUDE_NULL_VALUES
          ) AS [rows]([row_json]) FOR JSON PATH,
          INCLUDE_NULL_VALUES,
          WITHOUT_ARRAY_WRAPPER
      ) AS [albums]([json])
    WHERE
      EXISTS (
        SELECT
        FROM
          [public].[Album] AS [album]
        WHERE
          (
            ([album].[Title] LIKE @P1)
            AND ([artist].[ArtistId] = [album].[ArtistId])
          )
      ) FOR JSON PATH,
      INCLUDE_NULL_VALUES
  ) AS [rows]([row_json]) FOR JSON PATH,
  INCLUDE_NULL_VALUES,
  WITHOUT_ARRAY_WRAPPER

[(1, String("Supernatural"))]
